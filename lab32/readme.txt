Эта задача работает, но сделана она не совсем верно, 
и при большом количестве клиентов будут проблемы.